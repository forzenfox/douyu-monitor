# 代码静态检查说明

## 1. 概述

本项目使用ESLint和Prettier进行代码静态检查和格式化，确保代码质量和风格一致性。本文档详细介绍项目的静态检查配置、使用方法和最佳实践。

## 2. 配置说明

### 2.1 ESLint配置

项目使用ESLint v9.39.2进行代码质量检查，配置文件为`eslint.config.js`。

**主要配置项：**
- **检查文件**：所有`.js`文件
- **忽略目录**：`node_modules/`、`dist/`、`public/`、`*.md`、`*.json`
- **语言选项**：
  - ECMAScript版本：12
  - 模块类型：module
  - 全局变量：browser、node、es2021等
- **插件**：prettier
- **规则**：
  - 继承ESLint推荐规则
  - 继承Prettier配置规则
  - 启用Prettier错误检查
  - 关闭console检查
  - 警告debugger使用
  - 警告未使用变量
  - 关闭case声明检查

### 2.2 Prettier配置

项目使用Prettier v3.8.0进行代码格式化，配置文件为`.prettierrc.js`。

## 3. 使用方法

### 3.1 安装依赖

```bash
npm install
```

### 3.2 执行静态检查

#### 执行ESLint检查

```bash
npm run lint
```

#### 执行ESLint检查并自动修复

```bash
npm run lint:fix
```

#### 执行Prettier格式化

```bash
npm run format
```

## 4. Git钩子配置

### 4.1 安装husky和lint-staged

```bash
npm install --save-dev husky lint-staged
```

### 4.2 配置pre-commit钩子

在`package.json`中添加以下配置：

```json
"scripts": {
  // 现有脚本...
  "lint": "eslint .",
  "lint:fix": "eslint . --fix",
  "format": "prettier --write .",
  "prepare": "husky install"
},
"lint-staged": {
  "*.{js,vue}": [
    "eslint --fix",
    "prettier --write"
  ]
}
```

### 4.3 初始化husky

```bash
npm run prepare
npx husky add .husky/pre-commit "npx lint-staged"
```

## 5. CI/CD配置

在GitHub Actions workflow中添加静态检查步骤，确保在构建和测试之前先执行静态检查。

**示例配置（.github/workflows/test-build.yml）：**

```yaml
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Setup Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '16'
      - name: Install dependencies
        run: npm install
      - name: Run lint
        run: npm run lint
      - name: Run tests
        run: npm test
      - name: Build
        run: npm run build
```

## 6. 最佳实践

### 6.1 开发过程中

- 定期执行`npm run lint`检查代码质量
- 使用编辑器的ESLint和Prettier插件，实时检查和格式化代码
- 提交代码前执行`npm run lint:fix`和`npm run format`确保代码质量

### 6.2 团队协作

- 确保所有团队成员使用相同的编辑器配置
- 遵循项目的代码风格和质量要求
- 定期检查代码质量报告，持续改进代码质量

## 7. 常见问题及解决方案

### 7.1 ESLint检查失败

**问题**：ESLint检查失败，显示代码质量问题。

**解决方案**：
- 手动修复ESLint提示的问题
- 执行`npm run lint:fix`自动修复可修复的问题
- 对于无法自动修复的问题，根据ESLint提示手动修复

### 7.2 Prettier格式化不一致

**问题**：不同编辑器的Prettier格式化结果不一致。

**解决方案**：
- 确保所有团队成员使用相同版本的Prettier
- 统一编辑器的Prettier配置，使用项目的`.prettierrc.js`文件
- 提交代码前执行`npm run format`确保格式化一致

### 7.3 Git钩子执行缓慢

**问题**：pre-commit钩子执行静态检查时速度缓慢。

**解决方案**：
- 使用lint-staged只对暂存的文件执行检查
- 优化ESLint配置，减少不必要的检查
- 考虑使用缓存机制，提高检查速度

## 8. 总结

代码静态检查是确保代码质量和风格一致性的重要手段，通过本项目的配置和使用方法，可以有效提高代码质量，减少潜在问题，提高团队协作效率。

建议团队成员严格遵循本文档的要求，确保代码质量和风格一致性，共同维护一个高质量的代码库。