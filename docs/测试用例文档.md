# 斗鱼监控项目测试用例文档

## 1. 测试目的

- 验证斗鱼监控项目的功能完整性和正确性
- 确保项目在不同环境下的稳定运行
- 提高代码质量，减少bug数量
- 为后续开发和维护提供保障
- 确保用户体验符合预期

## 2. 测试范围

### 2.1 功能测试范围

| 模块 | 测试范围 |
|------|----------|
| 弹幕（Danmaku） | 弹幕渲染、过滤、样式自定义、重复弹幕折叠 |
| 入场信息（Enter） | 入场信息渲染、过滤、样式自定义 |
| 礼物（Gift） | 礼物信息渲染、过滤、高亮功能 |
| 超级弹幕（Superchat） | 超级弹幕渲染、样式配置、过期处理、价格等级展示 |
| 指令弹幕（CommandDanmaku） | 指令弹幕渲染、指令解析、指令执行效果 |
| 样式钩子函数 | useFlexStyle、useScroll、useBorderStyle、useNormalStyle |
| WebSocket连接 | WebSocket连接管理、消息处理、超级弹幕生成、过期状态计算 |
| 页面功能 | 布局切换、显示模式切换、数据阈值设置、模块开关功能 |
| 数据解析 | 弹幕数据解析、超级弹幕数据解析 |

### 2.2 非功能测试范围

- 性能测试：页面加载速度、数据处理效率
- 兼容性测试：不同浏览器、不同分辨率
- 稳定性测试：长时间运行稳定性

## 3. 测试环境

### 3.1 硬件环境

| 硬件 | 配置 |
|------|------|
| CPU | Intel Core i5及以上 |
| 内存 | 8GB及以上 |
| 磁盘 | 10GB可用空间 |

### 3.2 软件环境

| 软件 | 版本 |
|------|------|
| 操作系统 | Windows 11 / macOS / Linux |
| 浏览器 | Chrome 100+、Firefox 90+、Safari 15+ |
| Node.js | 16.0+ |
| npm | 8.0+ |

### 3.3 测试工具

| 工具 | 版本 | 用途 |
|------|------|------|
| Vitest | 4.0.17 | 单元测试 |
| Vue Test Utils | 2.4.6 | 组件测试 |
| Playwright | 1.57.0 | 端到端测试 |
| ESLint | 9.39.2 | 代码质量检查 |
| Prettier | 3.8.0 | 代码格式化 |

## 4. 测试策略

### 4.1 单元测试策略

- 使用Vitest进行单元测试
- 测试范围包括组件、钩子函数、工具函数等
- 测试覆盖率目标：≥80%
- 采用TDD（测试驱动开发）模式

### 4.2 组件测试策略

- 使用Vue Test Utils进行组件测试
- 测试组件的渲染、props传递、事件处理等
- 模拟外部依赖，确保测试的独立性

### 4.3 端到端测试策略

- 使用Playwright进行端到端测试
- 测试完整的用户流程
- 支持多浏览器测试
- 生成测试报告

### 4.4 测试执行策略

| 阶段 | 测试内容 | 执行方式 |
|------|----------|----------|
| 开发阶段 | 单元测试、组件测试 | 本地执行，使用watch模式 |
| 提交前 | 所有单元测试、代码 lint | CI自动执行 |
| 发布前 | 所有测试（单元+端到端）、测试覆盖率 | 本地+CI执行 |
| 回归测试 | 相关功能模块测试 | CI自动执行 |

## 5. 测试用例

### 5.1 组件测试用例

#### 5.1.1 弹幕组件（Danmaku）测试用例

| 用例ID | 测试模块 | 测试标题 | 前置条件 | 操作步骤 | 预期结果 | 实际结果 | 优先级 | 状态 |
|--------|----------|----------|----------|----------|----------|----------|--------|------|
| DAN-001 | Danmaku | 测试弹幕渲染功能 | 1. 项目已启动<br>2. 弹幕组件已加载 | 1. 模拟发送一条弹幕数据<br>2. 检查页面上是否显示该弹幕 | 弹幕内容正确显示，样式正常 | | 高 | 待测试 |
| DAN-002 | Danmaku | 测试弹幕过滤功能 | 1. 项目已启动<br>2. 弹幕组件已加载<br>3. 配置了弹幕过滤规则 | 1. 发送一条符合过滤规则的弹幕<br>2. 检查该弹幕是否被过滤 | 符合过滤规则的弹幕不显示 | | 高 | 待测试 |
| DAN-003 | Danmaku | 测试弹幕样式自定义 | 1. 项目已启动<br>2. 弹幕组件已加载<br>3. 配置了自定义弹幕样式 | 1. 发送一条弹幕<br>2. 检查弹幕样式是否符合配置 | 弹幕样式符合自定义配置 | | 中 | 待测试 |
| DAN-004 | Danmaku | 测试重复弹幕折叠 | 1. 项目已启动<br>2. 弹幕组件已加载<br>3. 配置了重复弹幕折叠功能 | 1. 连续发送多条相同内容的弹幕<br>2. 检查是否显示折叠后的弹幕 | 重复弹幕被折叠显示，显示重复次数 | | 中 | 待测试 |

#### 5.1.2 入场信息组件（Enter）测试用例

| 用例ID | 测试模块 | 测试标题 | 前置条件 | 操作步骤 | 预期结果 | 实际结果 | 优先级 | 状态 |
|--------|----------|----------|----------|----------|----------|----------|--------|------|
| ENT-001 | Enter | 测试入场信息渲染 | 1. 项目已启动<br>2. Enter组件已加载 | 1. 模拟用户入场<br>2. 检查页面上是否显示入场信息 | 入场信息正确显示，包含用户名、等级等信息 | | 高 | 待测试 |
| ENT-002 | Enter | 测试入场过滤功能 | 1. 项目已启动<br>2. Enter组件已加载<br>3. 配置了入场过滤规则 | 1. 符合过滤规则的用户入场<br>2. 检查该用户的入场信息是否显示 | 符合过滤规则的用户入场信息不显示 | | 高 | 待测试 |
| ENT-003 | Enter | 测试入场样式自定义 | 1. 项目已启动<br>2. Enter组件已加载<br>3. 配置了自定义入场样式 | 1. 模拟用户入场<br>2. 检查入场信息样式是否符合配置 | 入场信息样式符合自定义配置 | | 中 | 待测试 |

#### 5.1.3 礼物组件（Gift）测试用例

| 用例ID | 测试模块 | 测试标题 | 前置条件 | 操作步骤 | 预期结果 | 实际结果 | 优先级 | 状态 |
|--------|----------|----------|----------|----------|----------|----------|--------|------|
| GIF-001 | Gift | 测试礼物信息渲染 | 1. 项目已启动<br>2. Gift组件已加载 | 1. 模拟发送礼物<br>2. 检查页面上是否显示礼物信息 | 礼物信息正确显示，包含礼物名称、数量、赠送者等 | | 高 | 待测试 |
| GIF-002 | Gift | 测试礼物过滤功能 | 1. 项目已启动<br>2. Gift组件已加载<br>3. 配置了礼物过滤规则 | 1. 发送符合过滤规则的礼物<br>2. 检查该礼物是否被过滤 | 符合过滤规则的礼物不显示 | | 高 | 待测试 |
| GIF-003 | Gift | 测试礼物高亮功能 | 1. 项目已启动<br>2. Gift组件已加载<br>3. 配置了礼物高亮规则 | 1. 发送符合高亮规则的礼物<br>2. 检查该礼物是否高亮显示 | 符合高亮规则的礼物高亮显示 | | 中 | 待测试 |

#### 5.1.4 超级弹幕组件（Superchat）测试用例

| 用例ID | 测试模块 | 测试标题 | 前置条件 | 操作步骤 | 预期结果 | 实际结果 | 优先级 | 状态 |
|--------|----------|----------|----------|----------|----------|----------|--------|------|
| SCH-001 | Superchat | 测试超级弹幕渲染 | 1. 项目已启动<br>2. Superchat组件已加载 | 1. 模拟发送超级弹幕数据<br>2. 检查页面上是否显示该超级弹幕 | 超级弹幕正确显示，包含用户名、内容、价格等信息 | | 高 | 待测试 |
| SCH-002 | Superchat | 测试超级弹幕样式配置 | 1. 项目已启动<br>2. Superchat组件已加载<br>3. 配置了不同价格等级的超级弹幕样式 | 1. 发送不同价格的超级弹幕<br>2. 检查超级弹幕样式是否符合配置 | 不同价格的超级弹幕显示不同样式 | | 高 | 待测试 |
| SCH-003 | Superchat | 测试超级弹幕过期处理 | 1. 项目已启动<br>2. Superchat组件已加载<br>3. 配置了超级弹幕显示时间 | 1. 发送一条超级弹幕<br>2. 等待超过配置的显示时间<br>3. 检查超级弹幕是否过期 | 超过显示时间的超级弹幕显示过期样式 | | 高 | 待测试 |
| SCH-004 | Superchat | 测试不同价格等级的超级弹幕展示 | 1. 项目已启动<br>2. Superchat组件已加载<br>3. 配置了多个价格等级 | 1. 发送不同价格等级的超级弹幕<br>2. 检查超级弹幕的显示优先级 | 价格越高的超级弹幕显示优先级越高 | | 高 | 待测试 |
| SCH-005 | Superchat | 测试超级弹幕元素显示控制 | 1. 项目已启动<br>2. Superchat组件已加载<br>3. 配置了超级弹幕显示元素 | 1. 发送一条超级弹幕<br>2. 检查显示的元素是否符合配置 | 只显示配置中指定的元素 | | 中 | 待测试 |

#### 5.1.5 指令弹幕组件（CommandDanmaku）测试用例

| 用例ID | 测试模块 | 测试标题 | 前置条件 | 操作步骤 | 预期结果 | 实际结果 | 优先级 | 状态 |
|--------|----------|----------|----------|----------|----------|----------|--------|------|
| CMD-001 | CommandDanmaku | 测试指令弹幕渲染 | 1. 项目已启动<br>2. CommandDanmaku组件已加载 | 1. 模拟发送指令弹幕<br>2. 检查页面上是否显示该指令弹幕 | 指令弹幕正确显示，样式符合配置 | | 高 | 待测试 |
| CMD-002 | CommandDanmaku | 测试指令解析功能 | 1. 项目已启动<br>2. CommandDanmaku组件已加载 | 1. 发送包含指令的弹幕<br>2. 检查指令是否被正确解析 | 指令被正确解析，生成对应的指令对象 | | 高 | 待测试 |
| CMD-003 | CommandDanmaku | 测试指令执行效果 | 1. 项目已启动<br>2. CommandDanmaku组件已加载 | 1. 发送包含有效指令的弹幕<br>2. 检查指令是否被执行 | 指令被正确执行，产生预期效果 | | 高 | 待测试 |

### 5.2 钩子函数测试用例

#### 5.2.1 WebSocket钩子（useWebsocket）测试用例

| 用例ID | 测试模块 | 测试标题 | 前置条件 | 操作步骤 | 预期结果 | 实际结果 | 优先级 | 状态 |
|--------|----------|----------|----------|----------|----------|----------|--------|------|
| WSS-001 | useWebsocket | 测试WebSocket连接管理 | 1. 项目已启动<br>2. useWebsocket钩子已初始化 | 1. 建立WebSocket连接<br>2. 断开连接<br>3. 重新连接 | WebSocket连接正常建立、断开和重连 | | 高 | 待测试 |
| WSS-002 | useWebsocket | 测试消息处理逻辑 | 1. 项目已启动<br>2. WebSocket连接已建立 | 1. 发送不同类型的消息<br>2. 检查消息是否被正确处理 | 不同类型的消息被正确处理，生成对应的事件 | | 高 | 待测试 |
| WSS-003 | useWebsocket | 测试超级弹幕生成 | 1. 项目已启动<br>2. WebSocket连接已建立 | 1. 发送超级弹幕消息<br>2. 检查是否生成超级弹幕对象 | 超级弹幕消息被正确解析，生成超级弹幕对象 | | 高 | 待测试 |
| WSS-004 | useWebsocket | 测试过期状态计算 | 1. 项目已启动<br>2. WebSocket连接已建立 | 1. 发送一条超级弹幕<br>2. 检查超级弹幕的过期状态计算 | 超级弹幕的过期状态正确计算 | | 高 | 待测试 |

#### 5.2.2 样式钩子函数测试用例

| 用例ID | 测试模块 | 测试标题 | 前置条件 | 操作步骤 | 预期结果 | 实际结果 | 优先级 | 状态 |
|--------|----------|----------|----------|----------|----------|----------|--------|------|
| STY-001 | useFlexStyle | 测试弹性布局样式生成 | 1. 项目已启动<br>2. useFlexStyle钩子已初始化 | 1. 调用useFlexStyle钩子，传入不同配置<br>2. 检查生成的样式对象 | 生成的样式对象符合预期，包含正确的flex布局属性 | | 高 | 待测试 |
| STY-002 | useScroll | 测试滚动效果实现 | 1. 项目已启动<br>2. useScroll钩子已初始化 | 1. 调用useScroll钩子，传入不同配置<br>2. 检查生成的滚动样式和动画 | 生成的样式包含正确的滚动效果配置 | | 高 | 待测试 |
| STY-003 | useBorderStyle | 测试边框样式生成 | 1. 项目已启动<br>2. useBorderStyle钩子已初始化 | 1. 调用useBorderStyle钩子，传入不同配置<br>2. 检查生成的边框样式 | 生成的样式包含正确的边框属性 | | 高 | 待测试 |
| STY-004 | useNormalStyle | 测试普通样式生成 | 1. 项目已启动<br>2. useNormalStyle钩子已初始化 | 1. 调用useNormalStyle钩子，传入不同配置<br>2. 检查生成的普通样式 | 生成的样式包含正确的普通样式属性 | | 高 | 待测试 |

### 5.3 页面功能测试用例

| 用例ID | 测试模块 | 测试标题 | 前置条件 | 操作步骤 | 预期结果 | 实际结果 | 优先级 | 状态 |
|--------|----------|----------|----------|----------|----------|----------|--------|------|
| PAG-001 | 页面功能 | 测试布局切换功能 | 1. 项目已启动<br>2. 主页面已加载 | 1. 切换不同的布局模式<br>2. 检查页面布局是否改变 | 页面布局成功切换，符合预期 | | 高 | 待测试 |
| PAG-002 | 页面功能 | 测试显示模式切换 | 1. 项目已启动<br>2. 主页面已加载 | 1. 切换日/夜间模式<br>2. 检查页面样式是否改变 | 页面样式成功切换，符合日/夜间模式的预期 | | 高 | 待测试 |
| PAG-003 | 页面功能 | 测试数据阈值设置 | 1. 项目已启动<br>2. 主页面已加载 | 1. 设置不同的数据阈值<br>2. 发送符合条件的数据<br>3. 检查是否触发相应的处理 | 数据阈值设置生效，符合条件的数据触发相应处理 | | 中 | 待测试 |
| PAG-004 | 页面功能 | 测试模块开关功能 | 1. 项目已启动<br>2. 主页面已加载 | 1. 开启/关闭不同模块<br>2. 检查模块是否显示/隐藏 | 模块开关功能正常，开启的模块显示，关闭的模块隐藏 | | 高 | 待测试 |

### 5.4 工具函数测试用例

| 用例ID | 测试模块 | 测试标题 | 前置条件 | 操作步骤 | 预期结果 | 实际结果 | 优先级 | 状态 |
|--------|----------|----------|----------|----------|----------|----------|--------|------|
| UTL-001 | 数据解析 | 测试弹幕数据解析 | 1. 项目已启动<br>2. 数据解析函数已加载 | 1. 调用弹幕数据解析函数，传入测试数据<br>2. 检查解析结果 | 弹幕数据被正确解析，生成预期的弹幕对象 | | 高 | 待测试 |
| UTL-002 | 数据解析 | 测试超级弹幕数据解析 | 1. 项目已启动<br>2. 超级弹幕数据解析函数已加载 | 1. 调用超级弹幕数据解析函数，传入测试数据<br>2. 检查解析结果 | 超级弹幕数据被正确解析，生成预期的超级弹幕对象 | | 高 | 待测试 |

## 6. 测试执行计划

### 6.1 测试执行顺序

1. 单元测试：工具函数 → 钩子函数 → 组件测试
2. 端到端测试：主页面功能 → 配置页面功能 → 完整流程测试

### 6.2 测试执行频率

| 测试类型 | 执行频率 |
|----------|----------|
| 单元测试 | 开发过程中实时执行，提交前必须通过 |
| 组件测试 | 开发过程中实时执行，提交前必须通过 |
| 端到端测试 | 每日执行，发布前必须通过 |
| 回归测试 | 功能变更后执行 |

## 7. 测试报告

### 7.1 报告内容

- 测试用例执行情况（通过/失败数量）
- 测试覆盖率统计
- 发现的bug列表
- 测试环境信息
- 测试执行时间

### 7.2 报告生成方式

- 单元测试报告：通过Vitest生成，位于`coverage`目录
- 端到端测试报告：通过Playwright生成，位于`playwright-report`目录

## 8. 测试风险与应对措施

| 风险 | 应对措施 |
|------|----------|
| 测试环境配置复杂 | 编写详细的环境配置文档，提供自动化配置脚本 |
| 测试数据准备困难 | 创建模拟数据生成工具，使用真实数据备份 |
| 测试用例维护成本高 | 采用模块化设计，使用数据驱动的测试方法 |
| 测试覆盖率不足 | 定期检查测试覆盖率，补充缺失的测试用例 |
| 持续集成执行时间长 | 优化测试用例，采用并行执行策略 |

## 9. 测试结果分析

### 9.1 测试通过率目标

- 单元测试：100%
- 组件测试：95%以上
- 端到端测试：90%以上

### 9.2 缺陷等级定义

| 等级 | 定义 |
|------|------|
| 严重（Critical） | 导致系统崩溃、数据丢失或主要功能无法使用的缺陷 |
| 高（High） | 影响主要功能使用，但不导致系统崩溃的缺陷 |
| 中（Medium） | 影响部分功能使用，或导致用户体验下降的缺陷 |
| 低（Low） | 不影响功能使用，仅影响代码质量或美观的缺陷 |

## 10. 测试最佳实践

### 10.1 测试用例编写规范

- 每个测试用例只测试一个功能点
- 使用清晰、描述性的测试用例名称
- 添加适当的注释说明
- 使用模拟数据进行测试
- 确保测试用例的可维护性和可扩展性

### 10.2 测试执行建议

- 开发过程中使用`npm run test:watch`监视模式，实时反馈测试结果
- 提交代码前运行`npm run test`确保所有测试通过
- 发布前运行`npm run test:coverage`检查测试覆盖率
- 功能变更后运行相关组件的测试，确保功能正常

## 11. 常见问题与解决方案

| 问题 | 解决方案 |
|------|----------|
| 组件测试中没有渲染出预期元素 | 检查组件模板设计，确保测试环境配置正确，使用Vue Test Utils的正确API进行测试 |
| 模块路径问题 | 在测试中使用vi.mock模拟依赖，避免使用路径别名或在测试环境中配置路径别名 |
| 构造函数错误 | 完善mock实现，使用正确的构造函数语法，升级Vue Test Utils版本 |
| WebSocket连接测试困难 | 使用mock WebSocket实现，模拟WebSocket连接和消息 |
| 测试数据量大 | 使用数据生成工具，或使用部分代表性数据进行测试 |

## 12. 附录

### 12.1 测试环境配置说明

### 12.2 测试数据生成工具使用说明

### 12.3 测试报告查看指南

### 12.4 测试用例管理流程

## 13. 版本历史

| 版本 | 日期 | 变更内容 | 作者 |
|------|------|----------|------|
| 1.0 | 2026-01-26 | 初始版本 | AI助手 |